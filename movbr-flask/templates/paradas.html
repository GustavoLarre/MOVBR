<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Paradas</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <header class="header">
    <h1 class="logo">MOVBR</h1>
    <a href="/" class="btn-detalhe">Voltar</a>
  </header>

  <main style="padding: 2rem">
    <h2 style="margin-bottom: 1rem">Paradas de Ônibus</h2>

    <div class="map-container">
      <div id="map"></div>
    </div>

    <section class="card-list">
      {% for parada in paradas %}
      <div class="card">
        <div class="card-info">
          <h3>{{ parada.nome }}</h3>
          {% if parada.horarios %}
          <p>Próximos horários:
            {% for h in parada.horarios %}
              {{ h.horario_previsto }}{% if not loop.last %}, {% endif %}
            {% endfor %}
          </p>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </section>
  </main>

  <script>
    const paradas = {{ paradas | tojson }};
    const map = L.map('map').setView([-15.78, -47.93], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    paradas.forEach(parada => {
      if (parada.localizacao?.coordinates) {
        const [lng, lat] = parada.localizacao.coordinates;
        L.marker([lat, lng])
          .addTo(map)
          .bindPopup(`<strong>${parada.nome}</strong>`);
      }
    });
  </script>
</body>
</html>
