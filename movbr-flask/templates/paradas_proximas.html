{% extends "base.html" %}
{% block content %}
<h2>Paradas Próximas</h2>
<p>Baseado na sua localização atual.</p>
<div id="map" style="height: 500px;"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const paradas = {{ paradas|tojson }};
  navigator.geolocation.getCurrentPosition(pos => {
    const userPos = [pos.coords.latitude, pos.coords.longitude];
    const map = L.map('map').setView(userPos, 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    L.marker(userPos).addTo(map).bindPopup('Você está aqui').openPopup();
    paradas.forEach(p => {
      const [lng, lat] = p.localizacao.coordinates;
      L.marker([lat, lng]).addTo(map).bindPopup(p.nome);
    });
  });
</script>
{% endblock %}